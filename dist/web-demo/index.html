<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RemoteClaude Mobile Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .mobile-frame {
            max-width: 375px;
            margin: 20px auto;
            border: 3px solid #333;
            border-radius: 25px;
            background: #000;
            overflow: hidden;
            height: calc(100vh - 40px);
            position: relative;
        }

        .mobile-frame::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 4px;
            background: #333;
            border-radius: 2px;
            z-index: 10;
        }

        .app-container {
            background: #1a1a1a;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #404040;
        }

        .header-title {
            color: #1a73e8;
            font-size: 20px;
            font-weight: bold;
        }

        .disconnect-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px;
            background: #333;
            font-size: 11px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff6b6b;
            margin-right: 6px;
        }

        .status-dot.connected {
            background: #34a853;
        }

        .qr-scanner {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .scanner-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .scanner-text {
            text-align: center;
            color: #9aa0a6;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .scan-button {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .scan-button:hover {
            background: #1557b0;
        }

        .terminal {
            flex: 1;
            display: none;
            flex-direction: column;
        }

        .terminal.active {
            display: flex;
        }

        .terminal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #404040;
        }

        .terminal-title {
            color: #e0e0e0;
            font-size: 16px;
            font-weight: bold;
        }

        .clear-btn {
            background: #404040;
            color: #e0e0e0;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .terminal-output {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .output-line {
            margin-bottom: 2px;
        }

        .output-line.input {
            color: #1a73e8;
        }

        .output-line.error {
            color: #ff6b6b;
        }

        .output-line.system {
            color: #34a853;
            font-style: italic;
        }

        .terminal-input {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #2a2a2a;
            border-top: 1px solid #404040;
        }

        .prompt {
            color: #34a853;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-right: 10px;
        }

        .command-input {
            flex: 1;
            background: #404040;
            border: none;
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .send-btn {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            margin-left: 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .send-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .quick-commands {
            display: flex;
            gap: 8px;
            padding: 0 15px 15px;
        }

        .quick-btn {
            flex: 1;
            background: #404040;
            color: #9aa0a6;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }

        .executing {
            padding: 8px 15px;
            background: #333;
            border-radius: 6px;
            margin: 10px 15px;
            text-align: center;
            color: #ffa500;
            font-weight: bold;
        }

        @media (max-width: 400px) {
            .mobile-frame {
                border: none;
                border-radius: 0;
                margin: 0;
                height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-frame">
        <div class="app-container">
            <div class="header">
                <div class="header-title">RemoteClaude</div>
                <button class="disconnect-btn" onclick="disconnect()">ÂàáÊñ≠</button>
            </div>
            
            <div class="status-bar">
                <div style="display: flex; align-items: center;">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Disconnected</span>
                </div>
                <div id="serverUrl"></div>
            </div>
            
            <!-- QR Scanner Screen -->
            <div class="qr-scanner" id="scannerScreen">
                <div class="scanner-icon">üì±</div>
                <div class="scanner-text">
                    RemoteClaude„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö<br>
                    QR„Ç≥„Éº„Éâ„Çí„Çπ„Ç≠„É£„É≥„ÄÅ„Åæ„Åü„ÅØ<br>
                    Áõ¥Êé•Êé•Á∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
                <button class="scan-button" onclick="connectToServer()">
                    „Éá„É¢Êé•Á∂ö (localhost:8080)
                </button>
                <input type="text" id="manualUrl" placeholder="http://server-ip:8080" 
                       style="margin: 10px 0; padding: 8px; border-radius: 4px; border: 1px solid #666; background: #333; color: #e0e0e0; width: 200px;">
                <button class="scan-button" onclick="connectManual()" 
                        style="background: #34a853; font-size: 14px;">
                    ÊâãÂãïÊé•Á∂ö
                </button>
            </div>
            
            <!-- Terminal Screen -->
            <div class="terminal" id="terminalScreen">
                <div class="terminal-header">
                    <div class="terminal-title">Terminal</div>
                    <button class="clear-btn" onclick="clearTerminal()">Clear</button>
                </div>
                
                <div class="terminal-output" id="terminalOutput">
                    <div class="output-line system">RemoteClaude Terminal Ready</div>
                </div>
                
                <div id="executingIndicator" class="executing" style="display: none;">
                    Executing...
                </div>
                
                <div class="terminal-input">
                    <span class="prompt" id="promptSpan">$ </span>
                    <input type="text" class="command-input" id="commandInput" 
                           placeholder="Enter Claude command..." 
                           onkeypress="handleKeyPress(event)">
                    <button class="send-btn" id="sendBtn" onclick="sendCommand()">Send</button>
                </div>
                
                <div class="quick-commands">
                    <button class="quick-btn" onclick="quickCommand('claude -p \"Create a simple React component\"')">
                        Quick: React
                    </button>
                    <button class="quick-btn" onclick="quickCommand('git status')">
                        Git Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;
        let isExecuting = false;
        let serverUrl = '';

        function updateUI() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const disconnectBtn = document.querySelector('.disconnect-btn');
            const sendBtn = document.getElementById('sendBtn');
            const commandInput = document.getElementById('commandInput');
            const promptSpan = document.getElementById('promptSpan');

            if (isConnected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'Connected';
                disconnectBtn.style.display = 'block';
                document.getElementById('serverUrl').textContent = serverUrl.replace('http://', '');
                
                if (isExecuting) {
                    promptSpan.textContent = '[EXECUTING] $ ';
                    sendBtn.disabled = true;
                    commandInput.disabled = true;
                } else {
                    promptSpan.textContent = '$ ';
                    sendBtn.disabled = false;
                    commandInput.disabled = false;
                }
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'Disconnected';
                disconnectBtn.style.display = 'none';
                document.getElementById('serverUrl').textContent = '';
                promptSpan.textContent = '[DISCONNECTED] $ ';
                sendBtn.disabled = true;
                commandInput.disabled = true;
            }
        }

        function addOutput(text, type = 'output') {
            const output = document.getElementById('terminalOutput');
            const line = document.createElement('div');
            line.className = `output-line ${type}`;
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function connectToServer() {
            connectManual('http://localhost:8080');
        }

        function connectManual(url = null) {
            const targetUrl = url || document.getElementById('manualUrl').value || 'http://localhost:8080';
            serverUrl = targetUrl;
            
            addOutput('Connecting to ' + targetUrl + '...', 'system');
            
            const wsUrl = targetUrl.replace('http://', 'ws://').replace('https://', 'wss://') + '/api/ws';
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                authenticate();
            };
            
            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    handleMessage(message);
                } catch (error) {
                    console.error('Failed to parse message:', error);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                addOutput('Connection error: ' + error.message, 'error');
            };
            
            ws.onclose = () => {
                console.log('WebSocket closed');
                isConnected = false;
                updateUI();
                addOutput('Disconnected from server', 'error');
            };
        }

        function authenticate() {
            const authRequest = {
                type: 'auth',
                client_info: {
                    platform: 'web',
                    version: '1.0.0'
                }
            };
            
            ws.send(JSON.stringify(authRequest));
        }

        function handleMessage(message) {
            switch (message.type) {
                case 'auth_result':
                    if (message.status === 'success' || (message.data && message.data.status === 'success')) {
                        isConnected = true;
                        updateUI();
                        addOutput('Connected to RemoteClaude server!', 'system');
                        showTerminal();
                    } else {
                        addOutput('Authentication failed', 'error');
                    }
                    break;
                    
                case 'claude_output':
                    const data = message.data;
                    if (data.data && data.data.trim()) {
                        const outputType = data.status === 'error' ? 'error' : 'output';
                        addOutput(data.data, outputType);
                    }
                    
                    if (data.status === 'completed' || data.status === 'error') {
                        isExecuting = false;
                        document.getElementById('executingIndicator').style.display = 'none';
                        updateUI();
                    } else if (data.status === 'running') {
                        isExecuting = true;
                        document.getElementById('executingIndicator').style.display = 'block';
                        updateUI();
                    }
                    break;
                    
                case 'git_response':
                    const gitData = message.data;
                    const gitOutputType = gitData.status === 'error' ? 'error' : 'output';
                    addOutput(`Git ${gitData.operation}: ${gitData.data}`, gitOutputType);
                    isExecuting = false;
                    document.getElementById('executingIndicator').style.display = 'none';
                    updateUI();
                    break;
            }
        }

        function showTerminal() {
            document.getElementById('scannerScreen').style.display = 'none';
            document.getElementById('terminalScreen').classList.add('active');
        }

        function sendCommand() {
            const input = document.getElementById('commandInput');
            const command = input.value.trim();
            
            if (!command || !isConnected || isExecuting) {
                return;
            }
            
            addOutput(`$ ${command}`, 'input');
            
            isExecuting = true;
            document.getElementById('executingIndicator').style.display = 'block';
            updateUI();
            
            let request;
            if (command.startsWith('claude')) {
                request = {
                    type: 'claude_execute',
                    data: {
                        command: command,
                        options: {
                            mode: 'interactive',
                            timeout: 300
                        }
                    }
                };
            } else if (command.startsWith('git')) {
                const gitCommand = command.replace('git ', '');
                request = {
                    type: 'git_operation',
                    data: {
                        operation: gitCommand,
                        options: {}
                    }
                };
            } else {
                addOutput(`Unknown command: ${command}`, 'error');
                isExecuting = false;
                document.getElementById('executingIndicator').style.display = 'none';
                updateUI();
                input.value = '';
                return;
            }
            
            ws.send(JSON.stringify(request));
            input.value = '';
        }

        function quickCommand(command) {
            if (!isConnected || isExecuting) return;
            
            document.getElementById('commandInput').value = command;
            sendCommand();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendCommand();
            }
        }

        function clearTerminal() {
            document.getElementById('terminalOutput').innerHTML = '';
            addOutput('Terminal cleared', 'system');
        }

        function disconnect() {
            if (ws) {
                ws.close();
            }
            isConnected = false;
            isExecuting = false;
            updateUI();
            
            document.getElementById('scannerScreen').style.display = 'flex';
            document.getElementById('terminalScreen').classList.remove('active');
        }

        // Initialize
        updateUI();
    </script>
</body>
</html>