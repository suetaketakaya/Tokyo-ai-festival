<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RemoteClaude Server Control Panel</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ RemoteClaude Server Control Panel</h1>
            <div class="version">v3.6.0</div>
        </header>

        <div class="status-section">
            <div class="status-card">
                <h2>ğŸ“Š Server Status</h2>
                <div class="status-indicator">
                    <span id="server-status" class="status-dot running">ğŸŸ¢</span>
                    <span id="status-text">Running</span>
                </div>
                <div class="server-info">
                    <p><strong>Host:</strong> <span id="current-host">Loading...</span></p>
                    <p><strong>App Port:</strong> <span id="current-port">8090</span></p>
                    <p id="vpn-port-info" style="display: none;"><strong>VPN Port:</strong> <span id="vpn-port">51820</span></p>
                    <p><strong>Session Key:</strong> <span id="session-key">Loading...</span></p>
                </div>
            </div>

            <div class="clients-card">
                <h2>ğŸ“± Connected Clients</h2>
                <div id="client-list">
                    <div class="client-item">
                        <span>No clients connected</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="connection-section">
            <div class="mode-selector">
                <div class="mode-header">
                    <h2>ğŸŒ Connection Mode</h2>
                    <div class="current-mode-indicator">
                        <span class="mode-badge" id="current-mode-badge">Local Network</span>
                        <div class="mode-status" id="mode-status">
                            <span class="status-indicator-dot" id="mode-status-dot">ğŸŸ¢</span>
                            <span id="mode-status-text">Ready</span>
                        </div>
                    </div>
                </div>
                
                <div class="mode-cards">
                    <div class="mode-card" data-mode="local" id="local-card">
                        <div class="mode-card-header">
                            <span class="mode-icon">ğŸ </span>
                            <h3>Local Network</h3>
                            <div class="mode-indicator active" id="local-indicator">âœ“</div>
                        </div>
                        <p class="mode-description">åŒä¸€WiFiå†…ã§ã®æ¥ç¶šã€‚è¨­å®šãŒç°¡å˜ã§å³åº§ã«åˆ©ç”¨å¯èƒ½</p>
                        <div class="mode-features">
                            <span class="feature-tag">âœ“ ç°¡å˜è¨­å®š</span>
                            <span class="feature-tag">âœ“ é«˜é€Ÿæ¥ç¶š</span>
                        </div>
                    </div>
                    
                    <div class="mode-card" data-mode="vpn" id="vpn-card">
                        <div class="mode-card-header">
                            <span class="mode-icon">ğŸ”’</span>
                            <h3>WireGuard VPN</h3>
                            <div class="mode-indicator" id="vpn-indicator">â—‹</div>
                        </div>
                        <p class="mode-description">å¤–éƒ¨ã‹ã‚‰ã®å®‰å…¨ãªæ¥ç¶šã€‚æš—å·åŒ–ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ã‚¢é€šä¿¡</p>
                        <div class="mode-features">
                            <span class="feature-tag">ğŸ”’ æš—å·åŒ–</span>
                            <span class="feature-tag">ğŸŒ å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹</span>
                        </div>
                    </div>
                </div>
                
                <div class="mode-actions">
                    <button id="switch-mode-btn" class="primary-button" disabled>
                        <span class="button-icon">ğŸ”„</span>
                        <span class="button-text">Switch to VPN Mode</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="connection-section-main">
            <div class="qr-section">
                <div class="qr-header">
                    <h2>ğŸ“± Mobile App Connection</h2>
                    <div class="connection-status">
                        <span class="status-badge ready">Ready to Connect</span>
                    </div>
                </div>
                
                <div class="qr-container-improved">
                    <div class="qr-code-panel">
                        <div class="qr-code-wrapper">
                            <div id="qr-code">
                                <div class="qr-placeholder">
                                    <div class="qr-loading">ğŸ“±</div>
                                    <p>QR Code Loading...</p>
                                </div>
                            </div>
                        </div>
                        <div class="qr-instructions">
                            <p><strong>ğŸ“· Scan with RemoteClaude App</strong></p>
                            <p>1. Open RemoteClaude app</p>
                            <p>2. Tap scan button</p>
                            <p>3. Point camera at QR code</p>
                        </div>
                    </div>
                    
                    <div class="connection-details">
                        <div class="connection-url-section">
                            <h3>ğŸ”— Connection URL</h3>
                            <div class="url-container">
                                <div id="connection-url" class="url-display">Loading...</div>
                                <button id="copy-url-btn" class="icon-button" title="Copy URL">
                                    <span class="button-icon">ğŸ“‹</span>
                                </button>
                            </div>
                            <p class="url-hint">Tap "Enter URL Manually" in app if QR scan fails</p>
                        </div>
                        
                        <div class="connection-info">
                            <div class="info-row">
                                <span class="info-label">Server IP:</span>
                                <span class="info-value" id="info-host">Loading...</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">App Port:</span>
                                <span class="info-value" id="info-port">8090</span>
                            </div>
                            <div class="info-row" id="info-vpn-port" style="display: none;">
                                <span class="info-label">VPN Port:</span>
                                <span class="info-value" id="info-vpn-port-value">51820</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Session:</span>
                                <span class="info-value session-key" id="info-session">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="qr-actions">
                            <button id="regenerate-qr-btn" class="secondary-button">
                                <span class="button-icon">ğŸ”„</span>
                                <span class="button-text">Regenerate QR</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="vpn-setup-section" id="vpn-setup" style="display: none;">
            <h2>ğŸ” WireGuard VPN Setup</h2>
            
            <div class="port-info-panel">
                <h3>ğŸ”§ Required Port Configuration</h3>
                <div class="port-info-grid">
                    <div class="port-info-card">
                        <div class="port-icon">ğŸŒ</div>
                        <div class="port-details">
                            <div class="port-title">WireGuard VPN</div>
                            <div class="port-number">UDP 51820</div>
                            <div class="port-desc">Router port forwarding required</div>
                        </div>
                    </div>
                    <div class="port-info-card">
                        <div class="port-icon">ğŸ“±</div>
                        <div class="port-details">
                            <div class="port-title">RemoteClaude App</div>
                            <div class="port-number">TCP 8090</div>
                            <div class="port-desc">Internal server communication</div>
                        </div>
                    </div>
                </div>
                
                <div class="nat-config-section">
                    <h4>ğŸ  NAT/Port Forwarding Configuration</h4>
                    <div class="nat-config-info">
                        <div class="nat-rule">
                            <span class="nat-label">External Port:</span>
                            <span class="nat-value">UDP 51820</span>
                        </div>
                        <div class="nat-rule">
                            <span class="nat-label">Internal IP:</span>
                            <span class="nat-value" id="lan-ip-address">Loading...</span>
                        </div>
                        <div class="nat-rule">
                            <span class="nat-label">Internal Port:</span>
                            <span class="nat-value">UDP 51820</span>
                        </div>
                    </div>
                    <div class="nat-instruction">
                        <strong>Router Setup:</strong> Forward external UDP 51820 to <span id="lan-ip-display">this server's LAN IP</span>:51820
                    </div>
                </div>
            </div>
            
            <div class="setup-steps">
                <div class="step">
                    <h3>Step 1: iPhone Setup</h3>
                    <p>1. App Storeã‹ã‚‰WireGuardã‚¢ãƒ—ãƒªï¼ˆç„¡æ–™ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
                    <p>2. ã‚¢ãƒ—ãƒªã‚’é–‹ãã€Œ+ã€â†’ã€ŒQRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ä½œæˆã€ã‚’é¸æŠ</p>
                    <p>3. ä¸‹ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
                    <p class="port-note"><strong>Note:</strong> Router must forward UDP 51820 to this server</p>
                </div>
                
                <div class="wireguard-qr">
                    <div id="wireguard-qr-code">
                        <div class="qr-placeholder">WireGuard QR Code</div>
                    </div>
                    <button id="show-wireguard-qr" class="action-button">
                        ğŸ“± Show WireGuard QR Code
                    </button>
                </div>
                
                <div class="step">
                    <h3>Step 2: VPN Connection</h3>
                    <p>1. WireGuardã‚¢ãƒ—ãƒªã§è¨­å®šã‚’ä¿å­˜</p>
                    <p>2. VPNæ¥ç¶šã‚’ONã«ã™ã‚‹</p>
                    <p>3. RemoteClaudeã‚¢ãƒ—ãƒªã§ä¸‹è¨˜ã®VPNæ¥ç¶šQRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
                </div>
                
                <div class="vpn-connection-qr">
                    <h4>VPNæ¥ç¶šç”¨QRã‚³ãƒ¼ãƒ‰ (RemoteClaudeã‚¢ãƒ—ãƒªç”¨)</h4>
                    <div id="vpn-connection-qr-code">
                        <div class="qr-placeholder">VPN Connection QR Code</div>
                    </div>
                    <button id="show-vpn-connection-qr" class="action-button">
                        ğŸ“± Show VPN Connection QR Code
                    </button>
                </div>
            </div>
        </div>

        <!-- Container Management Section -->
        <div class="container-management-section">
            <h2>ğŸ“¦ Container Management</h2>
            
            <div class="container-info-panel">
                <h3>ğŸ³ Container Information</h3>
                <div id="container-list">
                    <div class="container-item">
                        <span>Loading container information...</span>
                    </div>
                </div>
            </div>

            <div class="container-commands-section">
                <h3>ğŸ”§ Container Access Commands</h3>
                <div class="command-grid">
                    <div class="command-item">
                        <h5>List Containers</h5>
                        <div class="code-block">
                            <code>docker ps -a</code>
                            <button class="copy-btn" onclick="copyToClipboard('docker ps -a')">ğŸ“‹</button>
                        </div>
                    </div>
                    <div class="command-item">
                        <h5>Access Container</h5>
                        <div class="code-block">
                            <code>docker exec -it [CONTAINER_NAME] /bin/bash</code>
                            <button class="copy-btn" onclick="copyToClipboard('docker exec -it [CONTAINER_NAME] /bin/bash')">ğŸ“‹</button>
                        </div>
                    </div>
                </div>

                <div class="connection-urls-section">
                    <h3>ğŸ”— Connection URLs</h3>
                    <div class="url-list">
                        <div class="url-item">
                            <strong>Wi-Fi Connection:</strong> 
                            <span id="wifi-connection-url">Loading...</span>
                            <button class="copy-btn" onclick="copyToClipboard(document.getElementById('wifi-connection-url').textContent)">ğŸ“‹</button>
                        </div>
                        <div class="url-item">
                            <strong>VPN Connection:</strong> 
                            <span id="vpn-connection-url">http://10.0.0.1:8090</span>
                            <button class="copy-btn" onclick="copyToClipboard(document.getElementById('vpn-connection-url').textContent)">ğŸ“‹</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-section">
            <h2>ğŸ› ï¸ Server Controls</h2>
            <div class="control-buttons">
                <div class="restart-control-group">
                    <button id="restart-btn" class="control-button restart">
                        <span class="button-icon">ğŸ”„</span>
                        <span class="button-text">Restart in Local Mode</span>
                    </button>
                    <div class="restart-options">
                        <button id="restart-dropdown-btn" class="dropdown-toggle" title="Restart Options">
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="dropdown-menu" id="restart-dropdown">
                            <div class="dropdown-item" onclick="window.dashboard.restartServer('local')">
                                <span class="dropdown-icon">ğŸ </span>
                                <div class="dropdown-content">
                                    <div class="dropdown-title">Local Network</div>
                                    <div class="dropdown-desc">Same WiFi connection</div>
                                </div>
                            </div>
                            <div class="dropdown-item" onclick="window.dashboard.restartServer('vpn')">
                                <span class="dropdown-icon">ğŸ”’</span>
                                <div class="dropdown-content">
                                    <div class="dropdown-title">VPN Mode</div>
                                    <div class="dropdown-desc">WireGuard secure connection</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="logs-btn" class="control-button">
                    ğŸ“‹ View Logs
                </button>
                <button id="settings-btn" class="control-button">
                    âš™ï¸ Settings
                </button>
            </div>
        </div>

        <div class="logs-section" id="logs-section" style="display: none;">
            <h2>ğŸ“‹ Server Logs</h2>
            <div class="logs-container">
                <pre id="server-logs">Loading logs...</pre>
            </div>
            <div class="logs-controls">
                <button id="refresh-logs-btn">ğŸ”„ Refresh</button>
                <button id="clear-logs-btn">ğŸ—‘ï¸ Clear</button>
                <button id="close-logs-btn">âŒ Close</button>
            </div>
        </div>
    </div>

    <!-- Password Input Modal -->
    <div id="password-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” Sudo Password Required</h2>
                <span class="close" id="password-modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <p>WireGuard VPN mode requires sudo privileges to configure the network interface.</p>
                <p>Please enter your system password:</p>
                
                <form id="password-form">
                    <div class="password-input-group">
                        <input type="password" id="sudo-password" placeholder="Enter sudo password" required>
                        <div class="password-visibility-toggle" id="password-toggle">
                            <span class="password-toggle-icon">ğŸ‘ï¸</span>
                        </div>
                    </div>
                    <div class="password-actions">
                        <button type="button" id="password-cancel" class="secondary-button">Cancel</button>
                        <button type="submit" id="password-submit" class="primary-button">
                            <span class="button-icon">ğŸ”</span>
                            <span class="button-text">Enable VPN Mode</span>
                        </button>
                    </div>
                </form>
                
                <div id="password-error" class="error-message" style="display: none;">
                    Invalid password or permission denied
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>