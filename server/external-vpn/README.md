# ğŸŒ RemoteClaude External VPN Server

## ğŸ“‹ æ¦‚è¦

TP-Linkãƒ«ãƒ¼ã‚¿ãƒ¼ã®WireGuardè¨­å®šã¨6to4 IPv6ãƒˆãƒ³ãƒãƒ«ã‚’æ´»ç”¨ã—ãŸå¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®RemoteClaudeæ¥ç¶šç’°å¢ƒã§ã™ã€‚

### ğŸ”§ TP-Link ãƒ«ãƒ¼ã‚¿ãƒ¼è¨­å®šæƒ…å ±

| é …ç›® | è¨­å®šå€¤ |
|------|--------|
| **WireGuard ãƒˆãƒ³ãƒãƒ«IP** | `10.5.5.1/32` |
| **ãƒªãƒƒã‚¹ãƒ³ãƒãƒ¼ãƒˆ** | `51820` |
| **IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹** | `192.168.11.108` |
| **ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯** | `255.255.255.0` |
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤** | `192.168.11.1` |
| **6to4 ãƒˆãƒ³ãƒãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹** | `2002:c0a8:b6c::c0a8:b6c/48` |

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. IPv6 6to4 ãƒˆãƒ³ãƒãƒ«è¨­å®š

```bash
cd /Users/suetaketakaya/1.prog/remote_manual/server/external-vpn
sudo ./setup-ipv6-tunnel.sh
```

### 2. å¤–éƒ¨VPNã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
sudo ./start-external-server.sh
```

### 3. iPhoneæ¥ç¶š

1. **WireGuardã‚¢ãƒ—ãƒª**ã‚’App Storeã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ç”Ÿæˆã•ã‚ŒãŸQRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³
3. VPNæ¥ç¶šã‚’æœ‰åŠ¹åŒ–
4. RemoteClaudeã‚¢ãƒ—ãƒªã§`ws://10.5.5.1:8090/ws`ã«æ¥ç¶š

---

## ğŸ“± ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š

### iPhoneã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**ç”Ÿæˆã•ã‚Œã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `~/.remoteclaude/external-vpn/clients/client-iphone.conf`

```ini
[Interface]
PrivateKey = [è‡ªå‹•ç”Ÿæˆ]
Address = 10.5.5.10/24
DNS = 1.1.1.1, 8.8.8.8

[Peer]
PublicKey = [ã‚µãƒ¼ãƒãƒ¼å…¬é–‹éµ]
Endpoint = 153.246.248.142:51820
AllowedIPs = 10.5.5.0/24
PersistentKeepalive = 25
```

### Android/PC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

è¿½åŠ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®è¨­å®šã¯æ‰‹å‹•ã§ä½œæˆå¯èƒ½ï¼š

```bash
# æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã‚­ãƒ¼ç”Ÿæˆ
wg genkey > client_private.key
wg pubkey < client_private.key > client_public.key

# ã‚µãƒ¼ãƒãƒ¼è¨­å®šã«ãƒ”ã‚¢è¿½åŠ 
sudo wg set wg0-external peer $(cat client_public.key) allowed-ips 10.5.5.11/32
```

---

## ğŸ”§ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šè©³ç´°

### WireGuard ã‚µãƒ¼ãƒãƒ¼è¨­å®š

- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: `wg0-external`
- **ã‚µãƒ¼ãƒãƒ¼IP**: `10.5.5.1/24`
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç¯„å›²**: `10.5.5.10-10.5.5.254`
- **ãƒãƒ¼ãƒˆ**: `51820/UDP`

### IPv6 6to4 ãƒˆãƒ³ãƒãƒ«

- **å¤–éƒ¨IP**: `153.246.248.142` â†’ **IPv6**: `2002:99f6:f88e::1/48`
- **ãƒˆãƒ³ãƒãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: `sit0`
- **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: `2000::/3 via ::192.168.11.1`

### RemoteClaude æ¥ç¶š

- **VPNå†…ã‚¢ãƒ‰ãƒ¬ã‚¹**: `ws://10.5.5.1:8090/ws`
- **Web UI**: `http://10.5.5.1:8080`
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼ç”Ÿæˆ

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### WireGuardæ¥ç¶šã§ããªã„å ´åˆ

```bash
# ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèª
sudo wg show

# ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å†èµ·å‹•
sudo wg-quick down wg0-external
sudo wg-quick up ~/.remoteclaude/external-vpn/wg0-external.conf

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ç¢ºèª
sudo iptables -L -v -n | grep wg
```

### IPv6æ¥ç¶šã§ããªã„å ´åˆ

```bash
# 6to4ãƒˆãƒ³ãƒãƒ«çŠ¶æ…‹ç¢ºèª
ip addr show sit0

# IPv6ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç¢ºèª
ip -6 route show

# IPv6æ¥ç¶šãƒ†ã‚¹ãƒˆ
ping6 -c 3 ipv6.google.com
```

### RemoteClaudeã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã§ããªã„å ´åˆ

```bash
# ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
ps aux | grep remoteclaude

# ãƒãƒ¼ãƒˆç¢ºèª
netstat -an | grep 8090

# VPNçµŒç”±æ¥ç¶šãƒ†ã‚¹ãƒˆ
nc -z 10.5.5.1 8090
```

---

## ğŸ“Š ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³

```
[å¤–éƒ¨ç«¯æœ«] --Internet--> [TP-Link Router:51820/UDP] 
                            |
                            v
                      [WireGuard VPN: 10.5.5.0/24]
                            |
                            v
                   [RemoteClaude Server: 10.5.5.1:8090]
                            |
                            v
                   [Docker Containers & Host System]
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### é«˜é€ŸåŒ–è¨­å®š

```bash
# ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
sudo sysctl -w net.core.rmem_default=262144
sudo sysctl -w net.core.rmem_max=134217728
sudo sysctl -w net.core.wmem_default=262144
sudo sysctl -w net.core.wmem_max=134217728

# WireGuardæœ€é©åŒ–
sudo sysctl -w net.ipv4.udp_mem="102400 873800 16777216"
```

### æ¥ç¶šç›£è¦–

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¥ç¶šç›£è¦–
watch -n 1 'sudo wg show; echo "---"; ss -tuln | grep 8090'
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **å®šæœŸçš„ãªã‚­ãƒ¼æ›´æ–°**: æœˆ1å›ã®é »åº¦ã§WireGuardã‚­ãƒ¼ã‚’æ›´æ–°
2. **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š**: å¿…è¦æœ€å°é™ã®ãƒãƒ¼ãƒˆã®ã¿é–‹æ”¾
3. **ãƒ­ã‚°ç›£è¦–**: ä¸æ­£æ¥ç¶šè©¦è¡Œã®ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆ
4. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã¦ãŠå•ã„åˆã‚ã›ãã ã•ã„ï¼š

1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
2. `sudo wg show` ã®å‡ºåŠ›
3. `ip addr show` ã®å‡ºåŠ›
4. ä½¿ç”¨ã—ã¦ã„ã‚‹ç«¯æœ«ã¨OSæƒ…å ±

---

**ä½œæˆæ—¥**: 2025-09-11  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0  
**å¯¾å¿œç’°å¢ƒ**: TP-Link Router + WireGuard + IPv6 6to4